"use strict";function insert_at_caret(e,t){var a,l=document.getElementById(e),i=l.scrollTop,o=0,r=l.selectionStart||"0"===l.selectionStart?"ff":!!document.selection&&"ie";"ie"===r?(l.focus(),(a=document.selection.createRange()).moveStart("character",-l.value.length),o=a.text.length):"ff"===r&&(o=l.selectionStart);var n=l.value.substring(0,o),c=l.value.substring(o,l.value.length);l.value=n+t+c,o+=t.length,"ie"===r?(l.focus(),(a=document.selection.createRange()).moveStart("character",-l.value.length),a.moveStart("character",o),a.moveEnd("character",0),a.select()):"ff"===r&&(l.selectionStart=o,l.selectionEnd=o,l.focus()),l.scrollTop=i}function inject_email_template(a,e){$.each(e,function(e,t){e=e.replace("email_template_",""),t&&-1<a.indexOf(e)&&("body"===e?$("#"+e).html(t):"pdf_template"===e?$("#"+e).val(t).trigger("change"):$("#"+e).val(t))})}function update_email_template_preview(){$("#email-template-preview").contents().find("body").html($(".email-template-body").val())}function insert_html_tag(e,t){var a,l,i,o,r,n,c,s;switch(e){case"text-bold":a=["<b>","</b>"];break;case"text-italic":a=["<em>","</em>"];break;case"text-paragraph":a=["<p>","</p>"];break;case"text-h1":a=["<h1>","</h1>"];break;case"text-h2":a=["<h2>","</h2>"];break;case"text-h3":a=["<h3>","</h3>"];break;case"text-h4":a=["<h4>","</h4>"];break;case"text-code":a=["<code>","</code>"];break;case"text-hr":a=["<hr/>",""];break;case"text-css":a=["<style></style>",""]}return l=document.getElementById(t),void 0!==document.selection?(l.focus(),i=document.selection.createRange().text):""!==l.selectionStart&&(o=l.selectionStart,r=l.selectionEnd,i=l.value.substring(o,r)),"text-css"===e?(n=a[0]+"\n\r"+l.value,$(l).val(n),update_email_template_preview(),!0):0===a[1].length?(insert_at_caret(t,a[0]),update_email_template_preview(),!0):(i&&i.length?(c=a[0]+i+a[1],s=l.value.length,n=l.value.substring(0,o)+c+l.value.substring(r,s),$(l).val(n)):insert_at_caret(t,a=a[0]+a[1]),void update_email_template_preview())}$(document).ready(function(){$.ajaxPrefilter(function(e){"post"!==e.type&&"POST"!==e.type&&"Post"!==e.type||(""===e.data?e.data+="?_ip_csrf="+Cookies.get("ip_csrf_cookie"):e.data+="&_ip_csrf="+Cookies.get("ip_csrf_cookie"))}),$(document).ajaxComplete(function(){$('[name="_ip_csrf"]').val(Cookies.get("ip_csrf_cookie"))});var e=$("#content"),t=$("html"),a=t.outerHeight()-$(".navbar").outerHeight()-$("#headerbar").outerHeight()-$("#submenu").outerHeight();e.outerHeight()<a&&e.outerHeight(a),t.click(function(){$(".dropdown-menu:visible").not(".datepicker").removeAttr("style")}),$('[data-toggle="tooltip"]').tooltip(),$(".simple-select").select2();new Clipboard(".to-clipboard");$(".taggable").on("focus",function(){window.lastTaggableClicked=this}),$(".tag-select").select2().on("change",function(e){var t=$(e.currentTarget);return void 0!==window.lastTaggableClicked&&insert_at_caret(window.lastTaggableClicked.id,t.val()),t.val([]),!1}),$(".html-tag").click(function(){insert_html_tag($(this).data("tagType"),$(".email-template-body").attr("id"))});var l=$(".email-template-body").attr("id");$("#email_template_preview").empty()&&update_email_template_preview(),$(l).bind("input propertychange",function(){update_email_template_preview()}),$("#email-template-preview-reload").click(function(){update_email_template_preview()}),$(document).on("click",".ajax-loader",function(e){var t=$(this).closest("form");if(t.length&&!t[0].checkValidity())return e.preventDefault(),e.stopImmediatePropagation(),t[0].reportValidity(),!1;$("#fullpage-loader").fadeIn(200),window.fullpageloaderTimeout=window.setTimeout(function(){$("#loader-error").fadeIn(200),$("#loader-icon").removeClass("fa-spin").addClass("text-danger")},1e4)}),$(document).on("click",".fullpage-loader-close",function(){$("#fullpage-loader").fadeOut(200),$("#loader-error").hide(),$("#loader-icon").addClass("fa-spin").removeClass("text-danger"),clearTimeout(window.fullpageloaderTimeout)});var i=$(".passwordmeter-input");i&&i.on("input",function(){var e=zxcvbn(i.val());$(".passmeter-2, .passmeter-3").hide(),4===e.score?$(".passmeter-2, .passmeter-3").show():3===e.score&&$(".passmeter-2").show()})});